<!doctype html>
<html lang="en">
  <head>
    <title>Codice Fiscale DEMO APP</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="frontend/Validation/validate.min.js"></script>

    <style> .invisible { display: none } </style>
  </head>
  <body>
    <h1>Demo APP V0 alpha!</h1>
    <fieldset>
      <legend>Codice Fiscale</legend>
        <form id="person" method="POST" action="">

          <label for="Name">Name: </label>
            <input name="name" id="name" placeholder="Name" value="Alessandro"><br><br>

          <label for="LastName">Last Name: </label>
            <input name="lastName" id="lastName" placeholder="Last Name" value="Frenna"><br><br>

          <label for="Date Of Birth">Date of birth: </label>
            <input type="date" id="dateOfBirth" name="dateOfBirth" value="1995-12-21"><br><br>

          <label for="City'">City</label>
            <input name="city" id="city" placeholder="City" value="Palermo"><br><br>

          <label for="Gender">Gender</label><br>
            M<input type="radio" name="gender" id="male" value="M" checked="checked">
            F<input type="radio" name="gender" id="female" value="F"><br><br>

          <button type="submit">Click</button>

        </form>

        <div class="validation-errors"></div>
      </fieldset>


    <p id="result"></p>
    <script src="lib/utilities.js"></script>
    <script src="lib/Person/Person.js"></script>
    <script src="lib/fiscalNumber.js"></script>
    <script src="frontend/data.js"></script>
    <script>
      let form = document.querySelector('form#person');
      let errorField = document.querySelector('div.validation-errors');
      let fieldsToValidate = [{
        name: 'name',
        display: 'Nome',
        rules: 'required|callback_betterAlpha'
      }, {
        name: 'lastName',
        display: 'Cognome',
        rules: 'required|callback_betterAlpha'
      }, {
        name: 'dateOfBirth',
        display: 'Data di nascita',
        rules: 'required'
      }, {
        name: 'city',
        display: 'CittÃ ',
        rules: 'required|callback_betterAlpha'
      }, {
        name: 'gender',
        display: 'Sesso',
        rules: 'required'
      }];


      let displayErrors = function (errors, event) {
        event.preventDefault();
        if (errors.length > 0 ) {

          while (errorField.firstChild) {
            errorField.removeChild(errorField.firstChild)
          }

          errorField.classList.remove('invisible');
          for (let i = 0; i < errors.length; i++) {
            let p = document.createElement("p");
            p.appendChild(document.createTextNode(errors[i].message));
            errorField.appendChild(p);
          }
        } else {
          errorField.classList.add('invisible');
          let personData = getUserData(form.querySelectorAll('input'));
          let person = new FiscalNumber(new Person (personData));
          person.code().then(output => {
              let result = document.querySelector('p#result');
              result.textContent = output;
          });
        }
      }

      let validator = new FormValidator(form, fieldsToValidate, displayErrors)

      validator.registerCallback('betterAlpha', function (value) {
        let regex = /[a-z/s\u00E0-\u00FC]+$/i;
          return(regex.test(value));
        });

      validator.setMessage('betterAlpha', 'The %s field must only contain alphabetical characters.');


    </script>
  </body>
</html>
